# PR Reviewers Assignment Service

Сервис для автоматического назначения ревьюверов на pull request'ы.

## Быстрый старт

### Клонировать репозиторий

```shell
    git clone https://github.com/blxxdclxud/PR-reviewers-assigner-avito.git
    cd PR-reviewers-assigner-avito
```

### Настроить переменные окружения

Создать .env из примера

```shell
    cp .env.example .env
```

### Запустить сервис

```shell
    docker-compose up --build
```

**ИЛИ**

```shell
    make up
```

### Остановить сервис

```shell
    docker compose down
```

**ИЛИ**

```shell
    make down
```

### Запуск тестов

```shell
    make test # Unit тесты
    make test-integration # Интеграционные тесты
    make test-e2e # E2E тесты
```

#### Сервис будет доступен на `http://localhost:8080`

## Требования

- Docker, Docker Compose
- Go 1.25 (для мануального запуска)

---

## Принятые решения

### 1. Дополнительные коды ошибок

В спецификации описаны доменные ошибки (`TEAM_EXISTS`, `PR_MERGED`, и т.д.). Дополнительно добавлены:

- **`INVALID_INPUT`** (400) — невалидное тело запроса (отсутствуют required поля, неверный JSON)
- **`INTERNAL_ERROR`** (500) — внутренняя ошибка сервера (проблемы с БД, неожиданные ошибки)

**Обоснование:** Для обеспечения полноценности API было необходимо не просто игнорировать эти ошибки, а выводить так же, как и другие задокументированные виды ошибок

### 2. Логирование

Используется structured logging (zap)

### 3. Транзакции

Все операции записи используют транзакции для гарантии консистентности:
- Создание команды с членами
- Создание PR с назначением ревьюверов
- Переназначение ревьюверов

**Обоснование:** Консистентность данных критична.


---

## Нагрузочное тестирование

Сервис протестирован с использованием утилиты [hey](https://github.com/rakyll/hey).

### Требования

- Объём данных: до 20 команд и до 200 пользователей
- RPS: 5
- SLI времени ответа: < 300 мс
- SLI успешности: > 99.9%

### Результаты тестирования

#### Тест 1: Базовая нагрузка (RPS = 5)

Тестирование `GET /team/get` с 5 конкурентными соединениями в течение 30 секунд.

| Метрика | Результат | Требование | Статус |
|---------|-----------|------------|------|
| RPS | **24.99** | 5 | **5x запас** |
| Среднее время ответа | **4.6 мс** | < 300 мс | **65x лучше** |
| P99 | **8.4 мс** | < 300 мс | **36x лучше** |
| Успешность | 100% | > 99.9% | |

#### Тест 2: Пиковая нагрузка (RPS = 20, 4x требований)

Тестирование `GET /team/get` с 20 конкурентными соединениями в течение 30 секунд.

| Метрика | Результат | Требование | Статус |
|---------|-----------|------------|------|
| RPS | **399.75** | 5 | **80x запас** |
| Среднее время ответа | **9.0 мс** | < 300 мс | **33x лучше** |
| P99 | **18.2 мс** | < 300 мс | **16x лучше** |
| Успешность | 100% | > 99.9% | |

#### Тест 3: Смешанный сценарий

Симуляция реального использования: создание 30 PR, чтение списка PR, merge 15 PR.

| Операция | Среднее время | Статус |
|----------|---------------|------|
| POST /pullRequest/create | ~15-20 мс | OK    |
| GET /users/getReview | **3.8 мс** | OK     |
| POST /pullRequest/merge | ~10-15 мс | OK     |

